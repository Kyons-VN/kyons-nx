"use strict";(self.webpackChunkschool=self.webpackChunkschool||[]).push([[572],{1572:(j,f,a)=>{a.r(f),a.d(f,{ResetPasswordComponent:()=>S});var m=a(6814),p=a(1474),e=a(8109),r=a(95),u=a(5476);const h=a(9448).N.serverApi;let g=(()=>{class t{constructor(){console.log("Create");const s=(0,e.f3M)(p.jN);this.http=new p.eN(s)}requestResetPassword(s){return this.http.post(h+"/student/forgot_password",{username:s})}newPassword(s,n,o){return this.http.put(h+"/student/update_password",{username:s,password:n,validation_code:o})}static#e=this.\u0275fac=function(n){return new(n||t)};static#s=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var v=a(1019),d=a(4793);const w=["emailElm"],x=["codeElm"],C=["passwordElm"];function Z(t,i){1&t&&(e.TgZ(0,"div"),e._uU(1,"Email is empty."),e.qZA())}function T(t,i){1&t&&(e.TgZ(0,"div"),e._uU(1,"Please use email with format abc@email.com."),e.qZA())}function P(t,i){if(1&t&&(e.TgZ(0,"div",18),e.YNc(1,Z,2,0,"div",19)(2,T,2,0,"div",19),e.qZA()),2&t){const s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",null==s.email.errors?null:s.email.errors.required),e.xp6(1),e.Q6J("ngIf",null==s.email.errors?null:s.email.errors.email)}}function I(t,i){1&t&&(e.TgZ(0,"div",18)(1,"div"),e._uU(2,"No email matching accounts found."),e.qZA()())}function y(t,i){1&t&&(e.TgZ(0,"div",20),e._uU(1,"Inaccurate information"),e.qZA())}const J=t=>({"!text-orange border-orange":t});function U(t,i){if(1&t){const s=e.EpF();e.TgZ(0,"form",9)(1,"p",10),e._uU(2,"Enter your email to receive the password change code."),e.qZA(),e._UZ(3,"div",7)(4,"input",11,12)(6,"div",13),e.YNc(7,P,3,2,"div",14)(8,I,3,0,"div",14)(9,y,2,0,"div",15),e._UZ(10,"div",16),e.TgZ(11,"button",17),e.NdJ("click",function(){e.CHM(s);const o=e.oxw();return e.KtG(o.sendEmail())}),e._uU(12),e.qZA()()}if(2&t){const s=e.oxw();e.Q6J("formGroup",s.emailForm),e.xp6(4),e.Q6J("ngClass",e.VKq(7,J,s.email.invalid||s.emailNotFound)),e.xp6(3),e.Q6J("ngIf",s.email.invalid&&(s.email.dirty||s.email.touched)),e.xp6(1),e.Q6J("ngIf",s.emailNotFound&&(s.email.dirty||s.email.touched)),e.xp6(1),e.Q6J("ngIf",s.errorMessage),e.xp6(2),e.Q6J("disabled",s.emailForm.touched&&s.emailForm.invalid||s.processing),e.xp6(1),e.hij(" ",s.processing?"Processing":"Send me the code"," ")}}function R(t,i){1&t&&(e.TgZ(0,"div"),e._uU(1,"Code is empty."),e.qZA())}function A(t,i){1&t&&(e.TgZ(0,"div"),e._uU(1,"Code's format is not correct."),e.qZA())}function Q(t,i){if(1&t&&(e.TgZ(0,"div",18),e.YNc(1,R,2,0,"div",19)(2,A,2,0,"div",19),e.qZA()),2&t){const s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",null==s.code.errors?null:s.code.errors.required),e.xp6(1),e.Q6J("ngIf",null==s.code.errors?null:s.code.errors.pattern)}}function q(t,i){1&t&&(e.TgZ(0,"div",18)(1,"div"),e._uU(2,"The verification code is not correct."),e.qZA()())}function F(t,i){1&t&&e._UZ(0,"i",30)}function b(t,i){1&t&&e._UZ(0,"i",31)}function N(t,i){1&t&&(e.TgZ(0,"div"),e._uU(1,"Password is empty."),e.qZA())}function E(t,i){1&t&&(e.TgZ(0,"div"),e._uU(1,"Password's format is not correct."),e.qZA())}function k(t,i){if(1&t&&(e.TgZ(0,"div",18),e.YNc(1,N,2,0,"div",19)(2,E,2,0,"div",19),e.qZA()),2&t){const s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",null==s.password.errors?null:s.password.errors.required),e.xp6(1),e.Q6J("ngIf",null==s.password.errors?null:s.password.errors.pattern)}}const c=t=>({"text-red-0":t});function M(t,i){if(1&t&&(e.TgZ(0,"div",32),e._uU(1," Password must have:"),e._UZ(2,"br"),e.TgZ(3,"ul",33)(4,"li",34),e._uU(5," At least 8 characters "),e.qZA(),e.TgZ(6,"li",34),e._uU(7," Uppercase letters (A-Z) "),e.qZA(),e.TgZ(8,"li",34),e._uU(9," Digit letters (0-9) "),e.qZA(),e.TgZ(10,"li",34),e._uU(11," Special characters (~! @#$%^&*_-+=`|\\(){}[]:;\"'<>,.?/) "),e.qZA()()()),2&t){const s=e.oxw(2);e.xp6(4),e.Q6J("ngClass",e.VKq(4,c,(s.password.dirty||s.password.touched)&&s.password.value.length<8)),e.xp6(2),e.Q6J("ngClass",e.VKq(6,c,(s.password.dirty||s.password.touched)&&s.notHaveUppercase(s.password.value))),e.xp6(2),e.Q6J("ngClass",e.VKq(8,c,(s.password.dirty||s.password.touched)&&s.notHaveDigit(s.password.value))),e.xp6(2),e.Q6J("ngClass",e.VKq(10,c,(s.password.dirty||s.password.touched)&&s.notHaveSpecial(s.password.value)))}}function H(t,i){if(1&t&&(e.TgZ(0,"div",18),e._uU(1),e.qZA()),2&t){const s=e.oxw(2);e.xp6(1),e.Oqu(s.errorMessage)}}const V=t=>({"!text-orange":t});function G(t,i){if(1&t){const s=e.EpF();e.TgZ(0,"form",9),e._UZ(1,"div",4),e.TgZ(2,"p",10),e._uU(3," The code has been sent to your email. Please check your email and enter the code in the box below. "),e.qZA(),e._UZ(4,"div",7)(5,"input",21,22)(7,"div",13),e.YNc(8,Q,3,2,"div",14)(9,q,3,0,"div",14),e._UZ(10,"div",16),e.TgZ(11,"div",23),e._UZ(12,"input",24,25),e.TgZ(14,"div",26),e.NdJ("click",function(){e.CHM(s);const o=e.oxw();return e.KtG(o.showPassword=!o.showPassword)}),e.YNc(15,F,1,0,"i",27)(16,b,1,0,"i",28),e.qZA()(),e._UZ(17,"div",13),e.YNc(18,k,3,2,"div",14),e._UZ(19,"div",16),e.YNc(20,M,12,12,"div",29)(21,H,2,1,"div",14),e._UZ(22,"div",7),e.TgZ(23,"button",17),e.NdJ("click",function(){e.CHM(s);const o=e.oxw();return e.KtG(o.sendCode())}),e._uU(24),e.qZA()()}if(2&t){const s=e.oxw();e.Q6J("formGroup",s.resetForm),e.xp6(5),e.Q6J("ngClass",e.VKq(12,V,s.wrongCode||s.code.invalid&&(s.code.dirty||s.code.touched))),e.xp6(3),e.Q6J("ngIf",s.code.invalid&&(s.code.dirty||s.code.touched)),e.xp6(1),e.Q6J("ngIf",s.wrongCode),e.xp6(3),e.Q6J("type",s.showPassword?"text":"password"),e.xp6(3),e.Q6J("ngIf",s.showPassword),e.xp6(1),e.Q6J("ngIf",!s.showPassword),e.xp6(2),e.Q6J("ngIf",s.password.invalid&&(s.password.dirty||s.password.touched)),e.xp6(2),e.Q6J("ngIf",s.password.touched),e.xp6(1),e.Q6J("ngIf",s.errorMessage),e.xp6(2),e.Q6J("disabled",s.resetForm.touched&&s.resetForm.invalid||s.processing),e.xp6(1),e.hij(" ",s.processing?"Processing":"Continue"," ")}}function Y(t,i){1&t&&(e.TgZ(0,"div",10),e._uU(1," Change password successfully! Please sign in and experience Kyons! "),e.qZA())}const K=(t,i)=>({"text-orange":t,btn:i});let S=(()=>{class t{constructor(s){this.route=s,this.paths=(0,e.f3M)(v.f).paths,this.fb=(0,e.f3M)(r.qu),this.class="h-full",this.emailForm=this.fb.group({}),this.resetForm=this.fb.group({}),this.email=new r.NI("",[r.kI.required,r.kI.email]),this.code=new r.NI("",[r.kI.required,r.kI.pattern(/^[0-9]{6,6}$/g)]),this.step=0,this.emailNotFound=!1,this.password=new r.NI("",[r.kI.required,r.kI.pattern(/^((?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*()~=_+}{":;'?{}/>.<,`\-|[\]]).{8,99})/)]),this.errorMessage="",this.processing=!1,this.isDebug=!1,this.wrongCode=!1,this.showPassword=!1,this.notHaveUppercase=d.JA,this.notHaveDigit=d._6,this.notHaveSpecial=d.W5,this.search=d.yC,this.accountService=new g}ngOnInit(){this.route.queryParams.subscribe(s=>{s.email&&(this.email.setValue(s.email),this.step=1,s.reset_token&&this.code.setValue(s.reset_token))}),this.emailForm.addControl("email",this.email),this.emailForm.get("email")?.valueChanges.subscribe(()=>{this.errorMessage="",this.emailNotFound=!1}),this.emailForm.get("code")?.valueChanges.subscribe(()=>{this.errorMessage="",this.wrongCode=!1}),this.resetForm.addControl("code",this.code),this.resetForm.addControl("password",this.password)}sendEmail(){this.emailForm.untouched?this.emailForm.markAllAsTouched():this.emailForm.invalid||(this.processing=!0,this.emailNotFound=!1,this.accountService.requestResetPassword(this.email.value).subscribe({next:()=>{this.step=1,this.processing=!1,setTimeout(()=>{this.codeElm.nativeElement.focus()},1e3)},error:s=>{console.log(s),this.emailNotFound=!0,this.processing=!1}}))}sendCode(){this.resetForm.markAsTouched(),!this.resetForm.invalid&&(this.processing=!0,this.emailNotFound=!1,this.accountService.newPassword(this.email.value,this.password.value,this.code.value).subscribe({next:()=>{this.step=2,this.processing=!1},error:s=>{console.log(s),"CodeMismatchException"==s.error.error_code?this.wrongCode=!0:this.errorMessage="ExpiredCodeException"==s.error.error_code?"M\xe3 code \u0111\xe3 h\u1ebft hi\u1ec7u l\u1ef1c, xin th\u1eed l\u1ea1i":s.error.message,this.processing=!1}}))}static#e=this.\u0275fac=function(n){return new(n||t)(e.Y36(u.gz))};static#s=this.\u0275cmp=e.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(n,o){if(1&n&&(e.Gf(w,5),e.Gf(x,5),e.Gf(C,5)),2&n){let l;e.iGM(l=e.CRH())&&(o.emailElm=l.first),e.iGM(l=e.CRH())&&(o.codeElm=l.first),e.iGM(l=e.CRH())&&(o.passwordElm=l.first)}},hostVars:2,hostBindings:function(n,o){2&n&&e.Tol(o.class)},standalone:!0,features:[e.jDz],decls:11,vars:8,consts:[[1,"flex","flex-col","md:flex-row","h-full"],[1,"flex","flex-col","w-full","h-full","items-center","justify-center","bg-primaryBlue"],[1,"flex","flex-col","w-full","sm:w-[434px]","p-4"],["src","./assets/images/logo-v.svg","alt","Logo",1,"h-24"],[1,"h-12"],["class","flex flex-col","autocomplete","off",3,"formGroup",4,"ngIf"],["class","text-white",4,"ngIf"],[1,"h-6"],[3,"routerLink","ngClass"],["autocomplete","off",1,"flex","flex-col",3,"formGroup"],[1,"text-white"],["type","text","placeholder","Enter email","formControlName","email","autocomplete","off",3,"ngClass"],["emailElm",""],[1,"h-1"],["class","error",4,"ngIf"],["class","error mt-1",4,"ngIf"],[1,"h-4"],[1,"btn",3,"disabled","click"],[1,"error"],[4,"ngIf"],[1,"error","mt-1"],["type","text","placeholder","Enter the code","formControlName","code","autocomplete","new-code",3,"ngClass"],["codeElm",""],[1,"relative","w-full"],["placeholder","Enter password","formControlName","password",1,"w-full",3,"type"],["passwordElm",""],[1,"absolute","right-0","top-0","w-11","h-full","flex","items-center","justify-center","cursor-pointer",3,"click"],["class","icon-VisibilityOff",4,"ngIf"],["class","icon-Visibility",4,"ngIf"],["class","text-white text-sm",4,"ngIf"],[1,"icon-VisibilityOff"],[1,"icon-Visibility"],[1,"text-white","text-sm"],[1,"list-disc"],[1,"ml-5",3,"ngClass"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"img",3)(4,"div",4),e.YNc(5,U,13,9,"form",5)(6,G,25,14,"form",5)(7,Y,2,0,"div",6),e._UZ(8,"div",7),e.TgZ(9,"a",8),e._uU(10,"Back to sign in"),e.qZA()()()()),2&n&&(e.xp6(5),e.Q6J("ngIf",0===o.step),e.xp6(1),e.Q6J("ngIf",1===o.step),e.xp6(1),e.Q6J("ngIf",2===o.step),e.xp6(2),e.Q6J("routerLink",o.paths.home.path)("ngClass",e.WLB(5,K,2!==o.step,2===o.step)))},dependencies:[m.ez,m.mk,m.O5,r.u5,r._Y,r.Fj,r.JJ,r.JL,r.UX,r.sg,r.u,u.Bz,u.rH,p.JF],styles:[".error[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem;--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity))}"]})}return t})()}}]);
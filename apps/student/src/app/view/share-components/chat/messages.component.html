<div class="body" #chatBody>
  @for (content of completeMessages; track content.createdAt; let i = $index) {
  <div class="message" [ngClass]="{ left: content.isModel, right: content.isUser }">
    <div class="avatar" *ngIf="content.isModel">
      <img src="assets/images/kyons-avatar.png" alt="" />
    </div>
    <div class="content">
      @for (message of content.parts; track $index) {
      <div class="box">
        @if(message.isText){
        <kyonsvn-latex [inputString]="message.text ?? ''" />
        }@else if(message.isData){
        <!-- prettier-ignore -->
        <div
          class=""
          intercepterObserver
          #intersection="intersection"
          [class.intersected]="intersection._isIntersecting"
          (isIntersecting)="isIntersecting($event, i, $index)"
          [isContinuous]="false"
        >
          @if(!message.isDeleted){
            @if(message.data!=null){
              @if(message.data.isImage){
                <img [src]="message.data.fileUri" />
              }
              @else if(message.data.isPdf||message.data.isText){
                @if(message.data.isPdf){
                  <mat-icon>picture_as_pdf</mat-icon>
                }
                @else {
                  <mat-icon>description</mat-icon>
                }
                <span
                  ><span class="line-clamp-1">{{ message.data.name.split('.')[0] }}</span
                  >.{{ message.data.name.split('.')[1] }}</span
                >
              }
            }
          } @else {<i class="">Ảnh đã bị xóa</i>}
        </div>
        }
      </div>
      @if(i===completeMessages.length-1 && $index === content.parts.length-1 && hasPlayBtn(message)){
      <button class="btn orange self-start" (click)="play()">Bắt đầu</button>
      } }
    </div>
  </div>
  } @if(isWriting){
  <div class="left message">
    <div class="avatar">
      <img src="assets/images/kyons-avatar.png" alt="" />
    </div>
    <div class="content">
      <div class="box">
        <p>{{ writingText }}</p>
      </div>
    </div>
  </div>
  } @else if(isThinking){
  <div class="left message">
    <div class="avatar">
      <img src="assets/images/kyons-avatar.png" alt="" />
    </div>
    <div class="content">
      <div class="box">
        <span class="p-[4px] flex gap-[4px] thinking">
          <span class="bg-blueGrey-400 w-[8px] aspect-square rounded-full"></span>
          <span class="bg-blueGrey-400 w-[8px] aspect-square rounded-full"></span>
          <span class="bg-blueGrey-400 w-[8px] aspect-square rounded-full"></span>
        </span>
      </div>
    </div>
  </div>
  }
</div>
